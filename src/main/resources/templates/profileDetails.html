<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<div class="row">
    <div class="col-12">
        <div class="cards">
            <div class="card border-0">
                <h2>My Profile </h2>
                <form th:action="@{/saveProfile}" th:object="${profileDetails}" id="profileform" method="post">
                    <input type="hidden" th:field="*{id}">

                    <div class="row mt-3">
                        <div class="text-danger text-end col-md-12"> * All fields are mandatory</div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="" class="form-label">User ID</label>
                                <input class="form-control" type="text" th:field="*{user_name}" readonly>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="" class="form-label">Mobile No.</label>
                                <input class="form-control" type="text" th:field="*{mobile_no}" readonly>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="" class="form-label">Email ID</label>
                                <input class="form-control" type="text" th:field="*{email}" readonly>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="" class="form-label">First Name</label>
                                <input class="form-control" type="text" th:field="*{first_name}" readonly>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="" class="form-label">Middle Name</label>
                                <input class="form-control" type="text" th:field="*{middle_name}" >
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="" class="form-label">Last Name</label>
                                <input class="form-control" type="text" th:field="*{last_name}" readonly>
                            </div>
                        </div>

                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="" class="form-label">Staff Code (Optional)</label>
                                <input class="form-control" type="text" th:field="*{staff_code}" >
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="designation" class="form-label">Designation</label>
                                <select class="form-control" id="designation" name="designation" required th:field="*{designation}">
                                    <option value="">Select Designation</option>
                                    <option th:value="'Assistant Professor'">Assistant Professor</option>
                                    <option th:value="'HOD'">HOD</option>
                                    <option th:value="'Associate Professor'">Associate Professor</option>
                                    <option th:value="'Director'">Director</option>
                                    <option th:value="'Lecturer'">Lecturer</option>
                                    <option th:value="'Principal'">Principal</option>
                                    <option th:value="'Professor'">Professor</option>
                                    <option th:value="'Other'">Other</option>
                                </select>

                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="" class="form-label">Other Designation, if any</label>
                                <input class="form-control" type="text" th:text="${other_designation}" >
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="mb-3">
                                <label for="" class="form-label">College</label>
                                <span class="form-control" th:text="${collegeDetails}" ></span>
                            </div>
                        </div>
                        <div class="col-md-1">
                            <div class="mb-3">
                                <label for="" class="form-label">Teaching Exp. <br />(In Years and Months)</label>
                                <input class="form-control" required type="text" th:field="*{teaching_experience}">
                            </div>
                        </div>

                        <div class="col-md-1">
                            <div class="mb-3">
                                <label for="" class="form-label">Industry Exp.<br /> (In Years and Months)</label>
                                <input class="form-control" required type="text" th:field="*{industry_experience}">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="institute_type" class="form-label">Institute Type</label>
                                <select class="form-control" id="institute_type" name="institute_type" required th:field="*{institute_type}">
                                    <option value="">Select</option>
                                    <option th:value="'Govt. Institute'">Govt. Institute</option>
                                    <option th:value="'Grant-in Aid Institute'">Grant-in Aid Institute</option>
                                    <option th:value="'Self-finance Institute'">Self-finance Institute</option>
                                    <option th:value="'External'">External</option>
                                </select>
                            </div>
                        </div>

                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="" class="form-label">Residential Address</label>
                                <textarea class="form-control" id="raddress" required
                                          th:field="*{residential_address}" name="typingarea"
                                          rows="5" cols="10" oninvalid="this.setCustomValidity('Please fill out this field.')"
                                          oninput="this.setCustomValidity('')">
</textarea>

                            </div>
                        </div>



                        <div class="col-md-12"><h2>Bank Details</h2></div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="" class="form-label">Account Number</label>
                                <input class="form-control"  required minlength="5" maxlength="30" type="text" th:field="*{account_no}">
                            </div>
                        </div> <div class="col-md-4">
                            <div class="mb-3">
                                <label for="" class="form-label">Account Type</label>
                                <select class="form-control" id="acc_type" name="acc_type" required th:field="*{acc_type}">
                                    <option value="">Select</option>
                                    <option th:value="'Savings Account'">Savings Account</option>
                                    <option th:value="'Current Account'">Current Account</option>
                                </select>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="" class="form-label">IFSC Code </label>
                                <input class="form-control"  type="text" th:field="*{ifsc_code}" required onblur="fetchBankDetails()">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="" class="form-label">Bank Name</label>
                                <input class="form-control" readonly required type="text" th:field="*{bank_name}">
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="" class="form-label">Branch Details </label>
                                <input class="form-control" required readonly type="text" th:field="*{branch_details}">
                            </div>
                        </div>

                        <div class="col-md-4">
                            <div class="mb-3">
                                <label for="" class="form-label">Branch Address </label>
                                <input class="form-control" required readonly type="text" th:field="*{branch_address}">
                            </div>
                        </div>

                        <div class="col-md-12">
                            <div class="mb-3">
                                <button class="btn btn-primary">Save &amp; Update</button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
<script>
function fetchBankDetails() {
var ifscCode = document.getElementById("ifsc_code").value.trim(); // Trim spaces

if (ifscCode.length !== 11) {
alert("IFSC Code must be exactly 11 characters.");
return;
}

fetch("https://online.ctestservices.com/gqpsecon/api/bank/getDetails/" + ifscCode)
.then(response => {
if (!response.ok) {
throw new Error("Invalid IFSC Code or API error");
}
return response.json();
})
.then(data => {
if (data && data.BANK && data.BRANCH && data.ADDRESS) {
document.getElementById("bank_name").value = data.BANK;
document.getElementById("branch_details").value = data.BRANCH;
document.getElementById("branch_address").value = data.ADDRESS;
} else {
alert("Invalid IFSC Code or no data found.");
}
})
.catch(error => {
console.error("Error:", error);
alert("Error fetching bank details. Please check the IFSC code.");
});
}
</script>


<script>
    document.getElementById("profileform").addEventListener("submit", function (event) {
        let textarea = document.getElementById("raddress");
        if (!textarea.value.trim()) {  // Trim to remove spaces
            alert("Please fill out the Residential Address field.");
            textarea.focus();
            event.preventDefault(); // Prevent form submission
        }
    });
</script>